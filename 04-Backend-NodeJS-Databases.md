# Backend (Node.js / Databases) - ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²ÑŒÑ

## ğŸ“š Ğ¢ĞµĞ¾Ñ€Ğ¸Ñ

### 1. Event Loop Ğ² Node.js

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Event Loop Ğ² Node.js? Ğ’ Ñ‡ĞµĞ¼ Ñ€Ğ°Ğ·Ğ½Ğ¸Ñ†Ğ° Ñ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ñ‹Ğ¼?

**ĞÑ‚Ğ²ĞµÑ‚:**

**Event Loop Ğ² Node.js** Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞµ libuv Ğ¸ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ°Ğ·:

```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â–ºâ”‚         timers            â”‚ setTimeout, setInterval
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚     pending callbacks     â”‚ I/O callbacks (Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚       idle, prepare       â”‚ Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚          poll             â”‚â—„â”€â”€â”€ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„Ğ°Ğ·Ğ° I/O
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚          check            â”‚ setImmediate
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚      close callbacks      â”‚ socket.on('close')
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—„â”€â”˜
```

**Ğ¤Ğ°Ğ·Ñ‹:**
1. **Timers:** Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ±ÑĞºĞ¾Ğ² setTimeout/setInterval
2. **Pending callbacks:** I/O ĞºĞ¾Ğ»Ğ±ÑĞºĞ¸, Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Ñ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
3. **Poll:** Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… I/O ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹, Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸Ñ… ĞºĞ¾Ğ»Ğ±ÑĞºĞ¾Ğ²
4. **Check:** Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ setImmediate ĞºĞ¾Ğ»Ğ±ÑĞºĞ¾Ğ²
5. **Close callbacks:** Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑĞ¾ĞºĞµÑ‚Ğ¾Ğ² Ğ¸ Ñ‚.Ğ´.

**Microtasks:**
- `process.nextTick()` â€” Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¾Ğ¼ Ğº ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ Ñ„Ğ°Ğ·Ğµ
- `Promise callbacks` â€” Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ nextTick
- Microtasks Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞšĞĞ–Ğ”ĞĞ™ Ñ„Ğ°Ğ·Ğ¾Ğ¹

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```javascript
setTimeout(() => console.log('timeout'), 0);
setImmediate(() => console.log('immediate'));
process.nextTick(() => console.log('nextTick'));
Promise.resolve().then(() => console.log('promise'));

// Ğ’Ñ‹Ğ²Ğ¾Ğ´: nextTick â†’ promise â†’ timeout/immediate (Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°)
```

**ĞÑ‚Ğ»Ğ¸Ñ‡Ğ¸Ñ Ğ¾Ñ‚ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°:**

| ĞÑĞ¿ĞµĞºÑ‚ | Browser | Node.js |
|--------|---------|---------|
| Ğ¤Ğ°Ğ·Ñ‹ | 2 (macro + micro) | 6+ Ñ„Ğ°Ğ· |
| setImmediate | ĞĞµÑ‚ | Ğ•ÑÑ‚ÑŒ |
| process.nextTick | ĞĞµÑ‚ | Ğ•ÑÑ‚ÑŒ (Ğ²Ñ‹ÑÑˆĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚) |
| requestAnimationFrame | Ğ•ÑÑ‚ÑŒ | ĞĞµÑ‚ |
| Worker threads | Web Workers | worker_threads |

---

### 2. Concurrency Model

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** Ğ’ Ñ‡ĞµĞ¼ Ñ€Ğ°Ğ·Ğ½Ğ¸Ñ†Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°Ğ¼Ğ¸, Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°Ğ¼Ğ¸ Ğ¸ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¼ I/O? ĞšĞ°Ğº Node.js Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ CPU-bound Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸?

**ĞÑ‚Ğ²ĞµÑ‚:**

**ĞŸÑ€Ğ¾Ñ†ĞµÑÑÑ‹:**
- Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ
- Ğ¢ÑĞ¶ĞµĞ»Ğ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ
- ĞšĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· IPC
- Node.js: `child_process`, `cluster`

**ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸:**
- ĞĞ±Ñ‰Ğ°Ñ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ
- Ğ›ĞµĞ³Ñ‡Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ²
- Ğ¢Ñ€ĞµĞ±ÑƒÑÑ‚ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- Node.js: `worker_threads`

**ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ I/O:**
- ĞĞ´Ğ¸Ğ½ Ğ¿Ğ¾Ñ‚Ğ¾Ğº, Ğ½ĞµĞ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‰Ğ¸Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- ĞšĞ¾Ğ»Ğ±ÑĞºĞ¸/Ğ¿Ñ€Ğ¾Ğ¼Ğ¸ÑÑ‹ Ğ´Ğ»Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
- ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ I/O-bound Ğ·Ğ°Ğ´Ğ°Ñ‡

**ĞœĞ¾Ğ´ĞµĞ»ÑŒ Node.js:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Main Thread                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   Event Loop                            â”‚â”‚
â”‚  â”‚  JavaScript execution (V8)                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              libuv Thread Pool (4 Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)         â”‚â”‚
â”‚  â”‚  â€¢ fs Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸                                          â”‚â”‚
â”‚  â”‚  â€¢ DNS lookup                                           â”‚â”‚
â”‚  â”‚  â€¢ crypto                                               â”‚â”‚
â”‚  â”‚  â€¢ zlib compression                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              OS Async Operations (epoll/kqueue/IOCP)    â”‚â”‚
â”‚  â”‚  â€¢ Network I/O                                          â”‚â”‚
â”‚  â”‚  â€¢ Pipes                                                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CPU-bound Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ â€” Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:**

**1. Worker Threads:**
```javascript
const { Worker, isMainThread, parentPort } = require('worker_threads');

if (isMainThread) {
  const worker = new Worker(__filename);
  worker.on('message', result => console.log(result));
  worker.postMessage({ data: heavyData });
} else {
  parentPort.on('message', data => {
    const result = heavyComputation(data);
    parentPort.postMessage(result);
  });
}
```

**2. Child Processes:**
```javascript
const { fork } = require('child_process');
const child = fork('heavy-task.js');
child.send({ data });
child.on('message', result => { /* ... */ });
```

**3. Cluster (Ğ´Ğ»Ñ HTTP ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²):**
```javascript
const cluster = require('cluster');
const numCPUs = require('os').cpus().length;

if (cluster.isMaster) {
  for (let i = 0; i < numCPUs; i++) {
    cluster.fork();
  }
} else {
  // Worker process
  require('./server');
}
```

**4. Ğ’Ñ‹Ğ½Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹:**
- ĞÑ‡ĞµÑ€ĞµĞ´Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡ (BullMQ, RabbitMQ)
- ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ´Ğ»Ñ Ñ‚ÑĞ¶ĞµĞ»Ñ‹Ñ… Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğ¹

---

### 3. Streams

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** ĞĞ±ÑŠÑÑĞ½Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² Ğ² Node.js (Readable, Writable, Duplex, Transform). ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸Ñ… Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ?

**ĞÑ‚Ğ²ĞµÑ‚:**

**ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸** â€” Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾, Ğ±ĞµĞ· Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ²ÑĞµĞ³Ğ¾ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ.

**Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²:**

| Ğ¢Ğ¸Ğ¿ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ |
|-----|----------|--------|
| Readable | Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | fs.createReadStream, http.IncomingMessage |
| Writable | ĞŸÑ€Ğ¸ĞµĞ¼Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… | fs.createWriteStream, http.ServerResponse |
| Duplex | Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ | net.Socket, TCP ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ |
| Transform | Duplex Ñ Ñ‚Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹ | zlib.createGzip, crypto.createCipher |

```
Readable Stream:
[Source] â”€â”€â–º data â”€â”€â–º data â”€â”€â–º data â”€â”€â–º end

Writable Stream:
data â”€â”€â–º data â”€â”€â–º data â”€â”€â–º [Destination]

Duplex Stream:
[Source] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º [Destination]
         read            write

Transform Stream:
[Input] â”€â”€â–º transform â”€â”€â–º [Output]
```

**Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Readable:**
- `data` â€” Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°
- `end` â€” Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ñ‹
- `error` â€” Ğ¾ÑˆĞ¸Ğ±ĞºĞ°
- `close` â€” Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚

**Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Writable:**
- `drain` â€” Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ° (Ğ¿Ğ¾ÑĞ»Ğµ backpressure)
- `finish` â€” Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹
- `error` â€” Ğ¾ÑˆĞ¸Ğ±ĞºĞ°

**Backpressure:**
```javascript
const readable = fs.createReadStream('large-file.txt');
const writable = fs.createWriteStream('output.txt');

readable.on('data', chunk => {
  const canContinue = writable.write(chunk);
  if (!canContinue) {
    readable.pause();
    writable.once('drain', () => readable.resume());
  }
});

// Ğ›ÑƒÑ‡ÑˆĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ pipe â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ backpressure
readable.pipe(writable);
```

**Pipeline (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ±):**
```javascript
const { pipeline } = require('stream/promises');
const zlib = require('zlib');

await pipeline(
  fs.createReadStream('input.txt'),
  zlib.createGzip(),
  fs.createWriteStream('input.txt.gz')
);
```

**ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:**
- Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ (Ğ²Ğ¸Ğ´ĞµĞ¾, Ğ»Ğ¾Ğ³Ğ¸)
- HTTP request/response body
- Real-time Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
- ETL Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹
- Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸

---

### 4. Transaction Isolation Levels

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** ĞĞ±ÑŠÑÑĞ½Ğ¸Ñ‚Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ğ¸ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹ Ğ² PostgreSQL.

**ĞÑ‚Ğ²ĞµÑ‚:**

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ½Ñ‹Ñ… Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¹:**

| ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|----------|
| Dirty Read | Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ½ĞµĞ·Ğ°ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸ |
| Non-repeatable Read | Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¼ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ñ‚Ğ¾Ğ¹ Ğ¶Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ |
| Phantom Read | ĞŸĞ¾ÑĞ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑÑ‚Ñ€Ğ¾Ğº Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ |
| Serialization Anomaly | Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ |

**Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸:**

| Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ | Dirty Read | Non-repeatable | Phantom | Serialization |
|---------|------------|----------------|---------|---------------|
| Read Uncommitted* | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ |
| Read Committed | ĞĞµÑ‚ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ |
| Repeatable Read | ĞĞµÑ‚ | ĞĞµÑ‚ | ĞĞµÑ‚** | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ |
| Serializable | ĞĞµÑ‚ | ĞĞµÑ‚ | ĞĞµÑ‚ | ĞĞµÑ‚ |

*Ğ’ PostgreSQL Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ ĞºĞ°Ğº Read Committed
**Ğ’ PostgreSQL Repeatable Read Ñ‚Ğ°ĞºĞ¶Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ phantom reads

**Read Committed (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ² PostgreSQL):**
```sql
BEGIN;
-- Ğ’Ğ¸Ğ´Ğ¸Ñ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
-- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ ÑĞ²ĞµĞ¶Ğ¸Ğ¹ snapshot
SELECT balance FROM accounts WHERE id = 1; -- 100
-- Ğ”Ñ€ÑƒĞ³Ğ°Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ Ğ¼ĞµĞ½ÑĞµÑ‚ balance Ğ½Ğ° 150 Ğ¸ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¸Ñ‚
SELECT balance FROM accounts WHERE id = 1; -- 150 (Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¾ÑÑŒ!)
COMMIT;
```

**Repeatable Read:**
```sql
BEGIN ISOLATION LEVEL REPEATABLE READ;
-- Snapshot ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ
SELECT balance FROM accounts WHERE id = 1; -- 100
-- Ğ”Ñ€ÑƒĞ³Ğ°Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ñ Ğ¼ĞµĞ½ÑĞµÑ‚ balance Ğ¸ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¸Ñ‚
SELECT balance FROM accounts WHERE id = 1; -- 100 (Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ snapshot)
-- ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞµ UPDATE ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ÑƒÑÑ‰ĞµĞ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ â€” ERROR
COMMIT;
```

**Serializable:**
```sql
BEGIN ISOLATION LEVEL SERIALIZABLE;
-- Ğ“Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚, Ñ‡Ñ‚Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ÑĞºĞ²Ğ¸Ğ²Ğ°Ğ»ĞµĞ½Ñ‚ĞµĞ½ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¼Ñƒ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
-- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ SSI (Serializable Snapshot Isolation)
-- ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ serialization_failure â€” Ğ½ÑƒĞ¶ĞµĞ½ retry
COMMIT;
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:**
- **Read Committed:** Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ½ÑÑ‚Ğ²Ğ¾ OLTP Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹
- **Repeatable Read:** Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹, Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‰Ğ¸Ğµ ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸
- **Serializable:** Ñ„Ğ¸Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸, ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ (Ñ retry Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¾Ğ¹)

---

### 5. SQL Optimization

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹? ĞĞ±ÑŠÑÑĞ½Ğ¸Ñ‚Ğµ B-tree vs Hash Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹. ĞšĞ°Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ EXPLAIN ANALYZE?

**ĞÑ‚Ğ²ĞµÑ‚:**

**B-tree Ğ¸Ğ½Ğ´ĞµĞºÑ (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ):**
```
             [50]
           /      \
      [20,30]    [70,80]
      /  |  \    /  |  \
   [10][25][35][60][75][90]
```

- Ğ£Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ñ‡ĞµĞ½Ğ½Ğ¾Ğµ Ğ´ĞµÑ€ĞµĞ²Ğ¾
- O(log n) Ğ¿Ğ¾Ğ¸ÑĞº, Ğ²ÑÑ‚Ğ°Ğ²ĞºĞ°, ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚: `=`, `<`, `>`, `<=`, `>=`, `BETWEEN`, `IN`, `LIKE 'prefix%'`
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ ORDER BY, MIN/MAX

**Hash Ğ¸Ğ½Ğ´ĞµĞºÑ:**
```
hash(key) â†’ bucket â†’ [values]
```

- O(1) Ğ´Ğ»Ñ equality (`=`)
- ĞĞ• Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ñ‹
- Ğ’ PostgreSQL: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ `=`
- ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ B-tree Ğ»ÑƒÑ‡ÑˆĞµ

**Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²:**

| Ğ¢Ğ¸Ğ¿ | Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ |
|-----|---------------|
| GiST | Ğ“ĞµĞ¾Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ, Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº |
| GIN | ĞœĞ°ÑÑĞ¸Ğ²Ñ‹, JSONB, Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚ |
| BRIN | ĞÑ‡ĞµĞ½ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ñ ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ¹ ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹ |

**EXPLAIN ANALYZE:**
```sql
EXPLAIN ANALYZE SELECT * FROM users WHERE email = 'test@example.com';

-- Ğ’Ñ‹Ğ²Ğ¾Ğ´:
-- Index Scan using users_email_idx on users  (cost=0.42..8.44 rows=1 width=64) (actual time=0.023..0.024 rows=1 loops=1)
--   Index Cond: (email = 'test@example.com'::text)
-- Planning Time: 0.085 ms
-- Execution Time: 0.043 ms
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸:**
- **cost:** Ğ¾Ñ†ĞµĞ½ĞºĞ° (startup..total) Ğ² ÑƒÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ñ… ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ğ°Ñ…
- **rows:** Ğ¾Ğ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑÑ‚Ñ€Ğ¾Ğº
- **actual time:** Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ (startup..total) Ğ² ms
- **loops:** ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹

**Ğ¢Ğ¸Ğ¿Ñ‹ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¾Ñ‚ Ğ»ÑƒÑ‡ÑˆĞµĞ³Ğ¾ Ğº Ñ…ÑƒĞ´ÑˆĞµĞ¼Ñƒ):**
1. **Index Only Scan** â€” Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ¸Ğ½Ğ´ĞµĞºÑĞ°
2. **Index Scan** â€” Ğ¸Ğ½Ğ´ĞµĞºÑ + Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ
3. **Bitmap Index Scan** â€” Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²
4. **Seq Scan** â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

**ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸Ğ½Ğ´ĞµĞºÑ ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ:**
- Ğ’Ñ‹Ğ±Ğ¾Ñ€ĞºĞ° Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ (>10-20%)
- ĞĞ¸Ğ·ĞºĞ°Ñ ÑĞµĞ»ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
- ĞĞµĞ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ½Ğ° Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ ÑÑ‚Ğ¾Ğ»Ğ±Ñ†Ğµ: `WHERE LOWER(email) = ...`

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²:**
```sql
-- ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ
CREATE INDEX idx_users_email ON users(email);

-- Partial Ğ¸Ğ½Ğ´ĞµĞºÑ
CREATE INDEX idx_active_users ON users(created_at) WHERE active = true;

-- Composite Ğ¸Ğ½Ğ´ĞµĞºÑ (Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ²Ğ°Ğ¶ĞµĞ½!)
CREATE INDEX idx_orders_user_date ON orders(user_id, created_at);

-- Covering Ğ¸Ğ½Ğ´ĞµĞºÑ (INCLUDE)
CREATE INDEX idx_users_email_inc ON users(email) INCLUDE (name);
```

---

### 6. Security

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** ĞĞ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¼ĞµÑ€Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ XSS, CSRF, SQL Injection Ğ¸ SSRF.

**ĞÑ‚Ğ²ĞµÑ‚:**

**SQL Injection:**
```javascript
// ĞŸĞ›ĞĞ¥Ğ
const query = `SELECT * FROM users WHERE id = ${userId}`;

// Ğ¥ĞĞ ĞĞ¨Ğ â€” Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
const query = 'SELECT * FROM users WHERE id = $1';
await client.query(query, [userId]);

// Ğ¡ ORM â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°
await User.findOne({ where: { id: userId } });
```

**XSS (Cross-Site Scripting):**
```javascript
// ĞŸĞ›ĞĞ¥Ğ â€” Ğ²ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ HTML
element.innerHTML = userInput;

// Ğ¥ĞĞ ĞĞ¨Ğ â€” ÑĞºÑ€Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
element.textContent = userInput;

// Ğ’ React â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞºÑ€Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
<div>{userInput}</div>

// ĞĞŸĞĞ¡ĞĞ Ğ² React
<div dangerouslySetInnerHTML={{ __html: userInput }} />

// HTTP Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸
Content-Security-Policy: default-src 'self'; script-src 'self'
X-XSS-Protection: 1; mode=block
```

**CSRF (Cross-Site Request Forgery):**
```javascript
// CSRF Ñ‚Ğ¾ĞºĞµĞ½
// 1. Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ Ğ¸ Ğ¾Ñ‚Ğ´Ğ°ĞµÑ‚ Ğ² cookie + hidden field
// 2. ĞŸÑ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ

// Express middleware
app.use(csrf());
app.get('/form', (req, res) => {
  res.render('form', { csrfToken: req.csrfToken() });
});

// SameSite cookie
res.cookie('session', token, { 
  sameSite: 'strict', // Ğ¸Ğ»Ğ¸ 'lax'
  httpOnly: true,
  secure: true 
});

// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Origin/Referer Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ²
```

**SSRF (Server-Side Request Forgery):**
```javascript
// ĞŸĞ›ĞĞ¥Ğ â€” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸Ñ€ÑƒĞµÑ‚ URL
const response = await fetch(userProvidedUrl);

// Ğ¥ĞĞ ĞĞ¨Ğ â€” Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¸ whitelist
const allowedHosts = ['api.example.com', 'cdn.example.com'];
const url = new URL(userProvidedUrl);

if (!allowedHosts.includes(url.hostname)) {
  throw new Error('Host not allowed');
}

// Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ñ… Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ²
if (url.hostname === 'localhost' || 
    url.hostname.startsWith('192.168.') ||
    url.hostname.startsWith('10.') ||
    url.hostname === '127.0.0.1') {
  throw new Error('Internal addresses not allowed');
}
```

**ĞĞ±Ñ‰Ğ¸Ğµ Ğ¼ĞµÑ€Ñ‹:**
- Input validation Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
- Output encoding
- Principle of least privilege
- Security headers (Helmet.js)
- Rate limiting
- Logging Ğ¸ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

---

### 7. ORM vs Raw SQL

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ñ‹ Raw SQL, ORM (Sequelize/TypeORM/Prisma) Ğ¸ Query Builder. ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ°ĞºĞ¾Ğ¹ Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ?

**ĞÑ‚Ğ²ĞµÑ‚:**

**Raw SQL:**
```javascript
const result = await client.query(
  `SELECT u.*, COUNT(o.id) as order_count
   FROM users u
   LEFT JOIN orders o ON o.user_id = u.id
   WHERE u.created_at > $1
   GROUP BY u.id
   HAVING COUNT(o.id) > $2`,
  [startDate, minOrders]
);
```

**ORM (Sequelize Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€):**
```javascript
const users = await User.findAll({
  where: {
    createdAt: { [Op.gt]: startDate }
  },
  include: [{
    model: Order,
    required: false
  }],
  group: ['User.id'],
  having: sequelize.literal('COUNT(Orders.id) > ' + minOrders)
});
```

**Prisma:**
```javascript
const users = await prisma.user.findMany({
  where: {
    createdAt: { gt: startDate }
  },
  include: {
    orders: true
  }
});
// Ğ”Ğ»Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² â€” $queryRaw
```

**Query Builder (Knex):**
```javascript
const users = await knex('users')
  .leftJoin('orders', 'orders.user_id', 'users.id')
  .where('users.created_at', '>', startDate)
  .groupBy('users.id')
  .havingRaw('COUNT(orders.id) > ?', [minOrders])
  .select('users.*', knex.raw('COUNT(orders.id) as order_count'));
```

**Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ:**

| ĞÑĞ¿ĞµĞºÑ‚ | Raw SQL | Query Builder | ORM |
|--------|---------|---------------|-----|
| ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ | Ğ›ÑƒÑ‡ÑˆĞ°Ñ | Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ* |
| ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ | ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ | Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ | ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹ |
| Ğ¢Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ | ĞĞµÑ‚ | Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ | Ğ”Ğ° (Prisma, TypeORM) |
| Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ | ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ | Ğ¡Ñ€ĞµĞ´Ğ½Ğµ | Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ |
| ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ | Ğ’Ñ€ÑƒÑ‡Ğ½ÑƒÑ | Ğ•ÑÑ‚ÑŒ | Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ |
| N+1 Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | ĞĞµÑ‚ | ĞĞµÑ‚ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ° |
| ĞĞ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ | SQL Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ | Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ | Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğµ |

*ORM Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½ĞµĞ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸:**
- **Raw SQL:** ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹, ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
- **Query Builder:** Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ĞµĞ¼ Ğ¸ ÑƒĞ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ¾Ğ¼
- **ORM:** CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸, Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°, Ñ‚Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
- **Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´:** ORM Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ³Ğ¾ + Raw Ğ´Ğ»Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾

---

### 8. Connection Pooling

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ½ÑƒĞ¶ĞµĞ½ connection pooling? ĞšĞ°Ğº Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿ÑƒĞ» ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹?

**ĞÑ‚Ğ²ĞµÑ‚:**

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° Ğ±ĞµĞ· Ğ¿ÑƒĞ»Ğ°:**
```
Request 1 â†’ New Connection â†’ Query â†’ Close Connection
Request 2 â†’ New Connection â†’ Query â†’ Close Connection
Request 3 â†’ New Connection â†’ Query â†’ Close Connection

ĞšĞ°Ğ¶Ğ´Ğ¾Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ: ~50-100ms Ğ½Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºÑƒ (TCP + auth)
```

**Ğ¡ connection pool:**
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
Request 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Connection Pool      â”‚
Request 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   [conn1] [conn2]      â”‚â”€â”€â”€â”€ Database
Request 3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   [conn3] [conn4]      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    
Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ
```

**ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° (node-postgres):**
```javascript
const { Pool } = require('pg');

const pool = new Pool({
  host: 'localhost',
  database: 'mydb',
  user: 'user',
  password: 'password',
  
  // Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ğ¿ÑƒĞ»Ğ°
  max: 20,                    // ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
  min: 5,                     // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ (idle)
  
  // Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ñ‹
  idleTimeoutMillis: 30000,   // Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ idle ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· 30s
  connectionTimeoutMillis: 2000, // Ğ–Ğ´Ğ°Ñ‚ÑŒ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ°ĞºÑ 2s
  
  // Ğ”Ğ»Ñ serverless
  allowExitOnIdle: true       // ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑƒ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒÑÑ
});

// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
const client = await pool.connect();
try {
  await client.query('SELECT ...');
} finally {
  client.release(); // Ğ’ĞĞ–ĞĞ: Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ² Ğ¿ÑƒĞ»
}

// Ğ˜Ğ»Ğ¸ ĞºĞ¾Ñ€Ğ¾Ñ‡Ğµ Ğ´Ğ»Ñ Ğ¾Ğ´Ğ¸Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
const result = await pool.query('SELECT ...');
```

**Prisma:**
```javascript
// Ğ’ connection string
DATABASE_URL="postgresql://user:pass@localhost:5432/db?connection_limit=20&pool_timeout=30"
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñƒ Ğ¿ÑƒĞ»Ğ°:**

```
max_connections = (CPU cores * 2) + effective_spindle_count
```

- Ğ”Ğ»Ñ SSD: `CPU * 2 + 1`
- ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ 10-20 Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹
- Ğ£Ñ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚ Ğ‘Ğ”: `max_connections` Ğ² PostgreSQL

**ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³:**
```javascript
pool.on('connect', () => console.log('New connection'));
pool.on('acquire', () => console.log('Connection acquired'));
pool.on('remove', () => console.log('Connection removed'));

// ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸
console.log({
  total: pool.totalCount,
  idle: pool.idleCount,
  waiting: pool.waitingCount
});
```

---

### 9. Caching Strategies

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** ĞĞ±ÑŠÑÑĞ½Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: Cache-Aside, Read-Through, Write-Through, Write-Behind.

**ĞÑ‚Ğ²ĞµÑ‚:**

**Cache-Aside (Lazy Loading):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     1. Get      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Cache  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                           â”‚
     â”‚ 2. Miss                   â”‚
     â”‚                           â”‚
     â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     3. Get      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚   App   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   DB    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Set cache
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cache  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
async function getUser(id) {
  // 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞµÑˆ
  let user = await cache.get(`user:${id}`);
  
  if (!user) {
    // 2. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Ğ‘Ğ”
    user = await db.users.findById(id);
    
    // 3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² ĞºĞµÑˆ
    await cache.set(`user:${id}`, user, { ttl: 3600 });
  }
  
  return user;
}
```
**ĞŸĞ»ÑÑÑ‹:** Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ°, ĞºĞµÑˆĞ¸Ñ€ÑƒÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
**ĞœĞ¸Ğ½ÑƒÑÑ‹:** cache miss penalty, Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ½ĞµÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ

**Read-Through:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Get     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Get     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Cache  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   DB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ (auto)  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
ĞšĞµÑˆ ÑĞ°Ğ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸ miss.
**ĞŸĞ»ÑÑÑ‹:** Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
**ĞœĞ¸Ğ½ÑƒÑÑ‹:** ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ

**Write-Through:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Write    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Write    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Cache  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   DB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ (sync)  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ñ‡ĞµÑ€ĞµĞ· ĞºĞµÑˆ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾.
**ĞŸĞ»ÑÑÑ‹:** ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ ĞºĞµÑˆĞ° Ğ¸ Ğ‘Ğ”
**ĞœĞ¸Ğ½ÑƒÑÑ‹:** ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ½Ğ°Ñ latency Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸

**Write-Behind (Write-Back):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Write    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   Async     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Cache  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   DB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚ (queue) â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² ĞºĞµÑˆ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ°Ñ, Ğ² Ğ‘Ğ” â€” Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾.
**ĞŸĞ»ÑÑÑ‹:** Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ, Ğ±Ğ°Ñ‚Ñ‡Ğ¸Ğ½Ğ³
**ĞœĞ¸Ğ½ÑƒÑÑ‹:** Ñ€Ğ¸ÑĞº Ğ¿Ğ¾Ñ‚ĞµÑ€Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ

**Ğ˜Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ ĞºĞµÑˆĞ°:**

```javascript
// 1. Time-based (TTL)
await cache.set(key, value, { ttl: 3600 });

// 2. Event-based
async function updateUser(id, data) {
  await db.users.update(id, data);
  await cache.del(`user:${id}`);
}

// 3. Version-based
await cache.set(`user:${id}:v${version}`, value);
```

**ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ»Ñ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- **Cache + DB Ğ² Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸** (ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ Ñ Redis)
- **Delayed invalidation** (eventual consistency)
- **Pub/Sub Ğ´Ğ»Ñ Ğ¸Ğ½Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸** (Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°)

---

### 10. API Design

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ:** Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚Ğµ REST, GraphQL Ğ¸ gRPC. ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ°ĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ?

**ĞÑ‚Ğ²ĞµÑ‚:**

**REST:**
```
GET    /users          - ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
GET    /users/123      - Ğ¾Ğ´Ğ¸Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
POST   /users          - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ
PUT    /users/123      - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ
PATCH  /users/123      - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾
DELETE /users/123      - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ

GET /users/123/orders  - Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹
```

**GraphQL:**
```graphql
# ĞĞ´Ğ¸Ğ½ endpoint, ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ Ñ‡Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾
query {
  user(id: 123) {
    name
    email
    orders(first: 5) {
      id
      total
    }
  }
}

mutation {
  createUser(input: { name: "John", email: "john@example.com" }) {
    id
    name
  }
}
```

**gRPC:**
```protobuf
// ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ² .proto Ñ„Ğ°Ğ¹Ğ»Ğµ
service UserService {
  rpc GetUser(GetUserRequest) returns (User);
  rpc ListUsers(ListUsersRequest) returns (stream User);
}

message User {
  int32 id = 1;
  string name = 2;
  string email = 3;
}
```

**Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ:**

| ĞÑĞ¿ĞµĞºÑ‚ | REST | GraphQL | gRPC |
|--------|------|---------|------|
| ĞŸÑ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ» | HTTP/1.1+ | HTTP | HTTP/2 |
| Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ | JSON | JSON | Protocol Buffers |
| ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ | OpenAPI/Swagger | Schema | .proto |
| Over-fetching | Ğ”Ğ° | ĞĞµÑ‚ | ĞĞµÑ‚ |
| Under-fetching | Ğ”Ğ° | ĞĞµÑ‚ | Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ |
| N+1 Ğ½Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğµ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ | ĞĞµÑ‚ | Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ |
| ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ | HTTP cache | Ğ¡Ğ»Ğ¾Ğ¶Ğ½ĞµĞµ | Ğ¡Ğ»Ğ¾Ğ¶Ğ½ĞµĞµ |
| Real-time | WebSocket Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ | Subscriptions | Streaming |
| ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ |
| Ğ‘Ñ€Ğ°ÑƒĞ·ĞµÑ€ | ĞĞ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ | ĞĞ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ | grpc-web |

**ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:**

**REST:**
- ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ API
- ĞŸÑ€Ğ¾ÑÑ‚Ñ‹Ğµ CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- HTTP ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ğ°Ğ¶Ğ½Ğ¾
- Ğ¨Ğ¸Ñ€Ğ¾ĞºĞ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

**GraphQL:**
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñ‹ (mobile, web) Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ½Ğ¾ÑÑ‚ÑĞ¼Ğ¸
- Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
- Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ API
- Ğ˜Ğ·Ğ±ĞµĞ¶Ğ°Ğ½Ğ¸Ğµ over/under-fetching

**gRPC:**
- ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ñ)
- High-performance Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Streaming Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

**Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´:**
- REST/GraphQL Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²
- gRPC Ğ´Ğ»Ñ Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²

---

## ğŸ’» ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºĞ° / Live Coding

### 1. Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ SQL Query

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ SQL-Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ JOIN, GROUP BY, HAVING Ğ¸ Ğ¾ĞºĞ¾Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼Ğ¸.

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°: Ğ¢Ğ¾Ğ¿-3 Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ°Ğ¼ Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸       â”‚
â”‚   Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¼ĞµÑÑÑ†, Ñ % Ğ¾Ñ‚ Ğ¾Ğ±Ñ‰Ğ¸Ñ… Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸         â”‚
â”‚                                                              â”‚
â”‚   Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  products   â”‚    â”‚   orders    â”‚    â”‚ order_items â”‚     â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚   â”‚ id          â”‚â—„â”€â”€â”€â”‚ id          â”‚â—„â”€â”€â”€â”‚ order_id    â”‚     â”‚
â”‚   â”‚ name        â”‚    â”‚ created_at  â”‚    â”‚ product_id  â”‚â”€â”€â”€â”€â–ºâ”‚
â”‚   â”‚ category_id â”‚    â”‚ status      â”‚    â”‚ quantity    â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ price       â”‚     â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Query Structure:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ WITH sales AS (                                         â”‚
  â”‚   -- ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ğ¼                      â”‚
  â”‚   SELECT product_id, SUM(quantity * price) as total     â”‚
  â”‚   FROM order_items                                      â”‚
  â”‚   JOIN orders ON ...                                    â”‚
  â”‚   WHERE orders.created_at > NOW() - INTERVAL '1 month'  â”‚
  â”‚   GROUP BY product_id                                   â”‚
  â”‚ ),                                                      â”‚
  â”‚ ranked AS (                                             â”‚
  â”‚   -- ĞĞºĞ¾Ğ½Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ½Ğ¶Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ¾Ğ²       â”‚
  â”‚   SELECT                                                â”‚
  â”‚     p.*, s.total,                                       â”‚
  â”‚     ROW_NUMBER() OVER (PARTITION BY category_id         â”‚
  â”‚                        ORDER BY total DESC) as rank,    â”‚
  â”‚     total / SUM(total) OVER (PARTITION BY category_id)  â”‚
  â”‚       * 100 as pct_of_category                          â”‚
  â”‚   FROM products p                                       â”‚
  â”‚   JOIN sales s ON s.product_id = p.id                   â”‚
  â”‚ )                                                       â”‚
  â”‚ SELECT * FROM ranked WHERE rank <= 3                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¸:**
- **CTE (WITH)** Ğ´Ğ»Ñ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸
- **JOIN** Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
- **GROUP BY** Ğ´Ğ»Ñ Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ğ¸
- **Window Functions:** ROW_NUMBER(), SUM() OVER (PARTITION BY)
- **HAVING** Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿

---

### 2. Rate Limiter Middleware

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞ¹Ñ‚Ğµ middleware Ğ´Ğ»Ñ rate limiting Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ sliding window.

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Sliding Window Rate Limiter                     â”‚
â”‚                                                              â”‚
â”‚  Request at time T:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     [â”€â”€â”€â”€â”€â”€â”€â”€â”€ Window (60 sec) â”€â”€â”€â”€â”€â”€â”€â”€â”€]               â”‚â”‚
â”‚  â”‚     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º              â”‚â”‚
â”‚  â”‚  T-60                                    T (now)         â”‚â”‚
â”‚  â”‚     â”‚    â€¢  â€¢    â€¢  â€¢  â€¢    â€¢  â€¢    â€¢    â”‚              â”‚â”‚
â”‚  â”‚     â”‚    Requests in window              â”‚              â”‚â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ (Sliding Window Log):                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1. Key = "rate:limit:{ip}" Ğ¸Ğ»Ğ¸ "{user_id}"              â”‚â”‚
â”‚  â”‚ 2. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ ÑÑ‚Ğ°Ñ€ÑˆĞµ (now - window)                 â”‚â”‚
â”‚  â”‚ 3. ĞŸĞ¾ÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¾ÑÑ‚Ğ°Ğ²ÑˆĞ¸ĞµÑÑ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸                          â”‚â”‚
â”‚  â”‚ 4. Ğ•ÑĞ»Ğ¸ count >= limit â†’ REJECT (429)                   â”‚â”‚
â”‚  â”‚ 5. Ğ˜Ğ½Ğ°Ñ‡Ğµ: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ timestamp, ALLOW             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  Redis Structure (Sorted Set):                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ZADD rate:limit:user:123 {timestamp} {timestamp}        â”‚â”‚
â”‚  â”‚ ZREMRANGEBYSCORE rate:limit:user:123 0 {now - window}   â”‚â”‚
â”‚  â”‚ ZCARD rate:limit:user:123                               â”‚â”‚
â”‚  â”‚ EXPIRE rate:limit:user:123 {window}                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ñ‹:**
- **Fixed Window:** Ğ¿Ñ€Ğ¾Ñ‰Ğµ, Ğ½Ğ¾ burst Ğ½Ğ° Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ğ¾ĞºĞ½Ğ°
- **Token Bucket:** Ğ¿Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ, ÑĞ»Ğ¾Ğ¶Ğ½ĞµĞµ
- **Leaky Bucket:** Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
- Redis Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ (Sorted Set Ğ¸Ğ»Ğ¸ String Ñ Lua script)
- Middleware Ğ´Ğ»Ñ Express/Fastify
- Headers: `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `Retry-After`

---

### 3. Database Migration

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ ÑĞ¾ ÑĞ²ÑĞ·ÑĞ¼Ğ¸ Ğ¸ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ğ¼Ğ¸.

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Migration Structure                        â”‚
â”‚                                                              â”‚
â”‚  Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²                       â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   users     â”‚         â”‚         comments            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”Œâ”€â”€â”€â–ºâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ id (PK)     â”‚â”€â”€â”€â”€â”˜    â”‚ id (PK)                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ user_id (FK) NOT NULL       â”‚    â”‚
â”‚                          â”‚ post_id (FK) NOT NULL       â”‚    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–ºâ”‚ parent_id (FK, self-ref)    â”‚    â”‚
â”‚  â”‚   posts     â”‚â”€â”€â”€â”€â”˜    â”‚ content TEXT NOT NULL       â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚ created_at TIMESTAMP        â”‚    â”‚
â”‚  â”‚ id (PK)     â”‚         â”‚ updated_at TIMESTAMP        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ deleted_at TIMESTAMP (soft) â”‚    â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â€¢ idx_comments_post_id (post_id)                        â”‚â”‚
â”‚  â”‚ â€¢ idx_comments_user_id (user_id)                        â”‚â”‚
â”‚  â”‚ â€¢ idx_comments_parent_id (parent_id) WHERE NOT NULL     â”‚â”‚
â”‚  â”‚ â€¢ idx_comments_created_at (created_at DESC)             â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ (Ğ¸Ğ´ĞµĞ¼Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ‚Ğ½Ğ°Ñ):                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ -- Up                                                   â”‚â”‚
â”‚  â”‚ CREATE TABLE IF NOT EXISTS comments (...)               â”‚â”‚
â”‚  â”‚ CREATE INDEX CONCURRENTLY IF NOT EXISTS ...             â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚ -- Down                                                 â”‚â”‚
â”‚  â”‚ DROP INDEX IF EXISTS ...                                â”‚â”‚
â”‚  â”‚ DROP TABLE IF EXISTS comments                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Best Practices:**
- `CREATE INDEX CONCURRENTLY` Ğ´Ğ»Ñ production
- Soft delete (`deleted_at`) Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ„Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
- Timestamps: `created_at`, `updated_at`
- `CHECK` constraints Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
- Down Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ°

---

### 4. API Endpoint

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ REST endpoint Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸ĞµĞ¹, Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¸ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸ĞµĞ¹.

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               API Endpoint Architecture                      â”‚
â”‚                                                              â”‚
â”‚  POST /api/orders                                            â”‚
â”‚                                                              â”‚
â”‚  Request Flow:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â”‚  Request â”€â”€â–º Middleware â”€â”€â–º Controller â”€â”€â–º Service      â”‚â”‚
â”‚  â”‚     â”‚           â”‚              â”‚             â”‚          â”‚â”‚
â”‚  â”‚     â”‚     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”‚             â”‚          â”‚â”‚
â”‚  â”‚     â”‚     â”‚ â€¢ Auth    â”‚       â”‚             â”‚          â”‚â”‚
â”‚  â”‚     â”‚     â”‚ â€¢ Rate    â”‚       â”‚        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”‚â”‚
â”‚  â”‚     â”‚     â”‚ â€¢ Logging â”‚       â”‚        â”‚  DB     â”‚     â”‚â”‚
â”‚  â”‚     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚        â”‚ (Trx)   â”‚     â”‚â”‚
â”‚  â”‚     â”‚                         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â”‚
â”‚  â”‚     â”‚                         â”‚                         â”‚â”‚
â”‚  â”‚     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                         â”‚â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â–ºâ”‚  Validator  â”‚â”€â”€â”€â”€â”€â”˜                         â”‚â”‚
â”‚  â”‚           â”‚  (Zod/Joi)  â”‚                               â”‚â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚â”‚
â”‚  â”‚                                                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  Transaction Flow:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ BEGIN TRANSACTION                                       â”‚â”‚
â”‚  â”‚   1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²                          â”‚â”‚
â”‚  â”‚   2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ order                                      â”‚â”‚
â”‚  â”‚   3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ order_items                                â”‚â”‚
â”‚  â”‚   4. Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ stock                                    â”‚â”‚
â”‚  â”‚   5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ payment intent                             â”‚â”‚
â”‚  â”‚ COMMIT (Ğ¸Ğ»Ğ¸ ROLLBACK Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ)                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                              â”‚
â”‚  Error Handling:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â€¢ ValidationError â†’ 400 Bad Request                     â”‚â”‚
â”‚  â”‚ â€¢ NotFoundError â†’ 404 Not Found                         â”‚â”‚
â”‚  â”‚ â€¢ ConflictError â†’ 409 Conflict                          â”‚â”‚
â”‚  â”‚ â€¢ InternalError â†’ 500 (logged, generic message)         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
- Validation schema (Zod/Joi)
- Error classes hierarchy
- Transaction wrapper Ñ retry
- Response format: `{ success, data, error, meta }`

---

### 5. Background Job System

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞ¹Ñ‚Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡ Ñ retry logic Ğ¸ dead letter queue.

**ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Background Job System Architecture               â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚  â”‚ Producerâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                            â”‚
â”‚                                 â–¼                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                    â”‚      Job Queue         â”‚                â”‚
â”‚                    â”‚  (Redis/RabbitMQ)      â”‚                â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                â”‚                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚              â–¼                 â–¼                 â–¼           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚         â”‚Worker 1 â”‚      â”‚Worker 2 â”‚      â”‚Worker 3 â”‚       â”‚
â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â”‚              â”‚                â”‚                â”‚             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                               â–¼                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚              â”‚         Job Processing         â”‚              â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚              â”‚  â”‚ 1. Fetch job            â”‚   â”‚              â”‚
â”‚              â”‚  â”‚ 2. Process              â”‚   â”‚              â”‚
â”‚              â”‚  â”‚ 3. Success â†’ Complete   â”‚   â”‚              â”‚
â”‚              â”‚  â”‚ 4. Failure:             â”‚   â”‚              â”‚
â”‚              â”‚  â”‚    attempts < max?      â”‚   â”‚              â”‚
â”‚              â”‚  â”‚    Yes â†’ Retry (delay)  â”‚   â”‚              â”‚
â”‚              â”‚  â”‚    No  â†’ Dead Letter Q  â”‚   â”‚              â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                               â”‚                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚              â”‚      Dead Letter Queue          â”‚             â”‚
â”‚              â”‚  (Ğ´Ğ»Ñ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸)         â”‚             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Retry Strategy (Exponential Backoff):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Attempt 1: immediate                                    â”‚
  â”‚ Attempt 2: delay = baseDelay * 2^1 = 1s * 2 = 2s       â”‚
  â”‚ Attempt 3: delay = baseDelay * 2^2 = 1s * 4 = 4s       â”‚
  â”‚ Attempt 4: delay = baseDelay * 2^3 = 1s * 8 = 8s       â”‚
  â”‚ ... Ğ´Ğ¾ maxAttempts (5)                                  â”‚
  â”‚                                                         â”‚
  â”‚ + jitter (ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ñ€Ğ¾Ñ) Ğ´Ğ»Ñ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ğ½Ğ¸Ñ thundering  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
- **Job Queue:** Redis (BullMQ) Ğ¸Ğ»Ğ¸ RabbitMQ
- **Job Schema:** { id, type, payload, attempts, status, createdAt }
- **Worker:** Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ, Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
- **Retry Logic:** exponential backoff + max attempts
- **Dead Letter Queue:** Ğ´Ğ»Ñ failed jobs
- **Monitoring:** Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸, Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹ Ğ½Ğ° DLQ

**BullMQ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€:**
```javascript
const queue = new Queue('email', { connection: redis });

// Producer
await queue.add('send-welcome', { userId: 123 }, {
  attempts: 5,
  backoff: { type: 'exponential', delay: 1000 }
});

// Worker
const worker = new Worker('email', async job => {
  await sendEmail(job.data.userId);
}, { connection: redis });

worker.on('failed', (job, err) => {
  if (job.attemptsMade >= job.opts.attempts) {
    // Move to DLQ
    dlqQueue.add(job.name, job.data);
  }
});
```
